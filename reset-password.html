<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reset Password — ParnassaHub</title>
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: { brand: { 50:'#ebf3ff',100:'#d6e8ff',200:'#add0ff',300:'#85b8ff',400:'#5c9ef5',500:'#2877C9',600:'#1d62aa',700:'#154d8b' } },
          fontFamily: { sans: ['Nunito', 'system-ui', 'sans-serif'] }
        }
      }
    }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Nunito', system-ui, sans-serif; }
    input:focus { outline: none; }
    .pwd-wrap { position: relative; }
    .pwd-wrap input { padding-right: 2.75rem; }
    .pwd-toggle { position:absolute;right:10px;top:50%;transform:translateY(-50%);cursor:pointer;color:#9ca3af;background:none;border:none;padding:4px; }
    .pwd-toggle:hover { color:#6b7280; }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 antialiased min-h-screen flex flex-col">

<header class="bg-white border-b border-gray-100 py-4 px-6">
  <a href="index.html">
    <img src="parnassah hub.png" alt="ParnassaHub" class="h-14 w-auto" />
  </a>
</header>

<main class="flex-1 flex items-start justify-center py-10 px-4">
  <div class="w-full max-w-md">

    <div id="error-banner" class="hidden mb-4 p-3 bg-red-50 border border-red-200 rounded-xl text-sm text-red-700"></div>

    <!-- Invalid / expired link -->
    <div id="screen-invalid" class="hidden bg-white rounded-2xl border border-gray-200 p-8 text-center">
      <div class="w-16 h-16 rounded-full bg-red-50 flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/></svg>
      </div>
      <h2 class="text-xl font-bold text-gray-900 mb-2">Link expired or invalid</h2>
      <p class="text-sm text-gray-500 mb-6">This password reset link has expired or already been used. Request a new one from the sign-in page.</p>
      <a href="signup.html?view=signin" class="w-full inline-flex items-center justify-center py-3.5 bg-brand-500 hover:bg-brand-600 text-white font-semibold text-sm rounded-xl transition">Back to Sign In</a>
    </div>

    <!-- Reset form -->
    <div id="screen-form" class="hidden">
      <div class="text-center mb-8">
        <h1 class="text-2xl font-extrabold text-gray-900 mb-2">Choose a new password</h1>
        <p class="text-gray-500 text-sm">Enter a new password for your account.</p>
      </div>
      <div class="bg-white rounded-2xl border border-gray-200 p-6 space-y-4">
        <div>
          <label class="block text-xs font-medium text-gray-600 mb-1.5">New Password</label>
          <div class="pwd-wrap">
            <input id="new-password" type="password" placeholder="Min. 8 characters" class="w-full px-3.5 py-2.5 border border-gray-200 rounded-xl text-sm focus:border-brand-400 transition" />
            <button type="button" class="pwd-toggle" onclick="togglePwd('new-password', this)" aria-label="Show password">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
            </button>
          </div>
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-600 mb-1.5">Confirm New Password</label>
          <div class="pwd-wrap">
            <input id="confirm-password" type="password" placeholder="Repeat your new password" class="w-full px-3.5 py-2.5 border border-gray-200 rounded-xl text-sm focus:border-brand-400 transition" />
            <button type="button" class="pwd-toggle" onclick="togglePwd('confirm-password', this)" aria-label="Show password">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
            </button>
          </div>
        </div>
        <button onclick="doReset()" id="reset-btn" class="w-full py-3.5 bg-brand-500 hover:bg-brand-600 text-white font-semibold text-sm rounded-xl transition">
          Set New Password
        </button>
      </div>
    </div>

    <!-- Success -->
    <div id="screen-success" class="hidden bg-white rounded-2xl border border-gray-200 p-8 text-center">
      <div class="w-16 h-16 rounded-full bg-green-50 flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
      </div>
      <h2 class="text-xl font-bold text-gray-900 mb-2">Password updated!</h2>
      <p class="text-sm text-gray-500 mb-6">Your password has been changed successfully. You can now sign in with your new password.</p>
      <a href="signup.html?view=signin" class="w-full inline-flex items-center justify-center py-3.5 bg-brand-500 hover:bg-brand-600 text-white font-semibold text-sm rounded-xl transition">Sign In</a>
    </div>

  </div>
</main>

<footer class="text-center py-6 text-xs text-gray-400">
  &copy; 2026 ParnassaHub &middot; Volunteer-run &middot;
  <a href="about.html" class="hover:text-gray-600">About</a> &middot;
  <a href="mailto:info@parnassahub.com" class="hover:text-gray-600">Contact</a>
</footer>

<script src="js/supabase-client.js"></script>
<script>
  function showError(msg) {
    const el = document.getElementById('error-banner')
    el.textContent = msg
    el.classList.remove('hidden')
  }

  function togglePwd(inputId, btn) {
    const input = document.getElementById(inputId)
    const isText = input.type === 'text'
    input.type = isText ? 'password' : 'text'
    btn.setAttribute('aria-label', isText ? 'Show password' : 'Hide password')
    btn.innerHTML = isText
      ? '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>'
      : '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/></svg>'
  }

  // Supabase fires PASSWORD_RECOVERY when the user arrives via the reset link
  sb.auth.onAuthStateChange((event, session) => {
    if (event === 'PASSWORD_RECOVERY') {
      document.getElementById('screen-form').classList.remove('hidden')
    } else if (event === 'SIGNED_IN' && !document.getElementById('screen-form').classList.contains('hidden')) {
      // already showing the form, do nothing
    } else if (!session) {
      // No recovery session — link is invalid or expired
      document.getElementById('screen-invalid').classList.remove('hidden')
    }
  })

  async function doReset() {
    const password = document.getElementById('new-password').value
    const confirm  = document.getElementById('confirm-password').value
    if (password.length < 8) { showError('Password must be at least 8 characters.'); return }
    if (password !== confirm) { showError('Passwords do not match.'); return }

    const btn = document.getElementById('reset-btn')
    btn.textContent = 'Updating…'; btn.disabled = true

    const { error } = await sb.auth.updateUser({ password })
    btn.textContent = 'Set New Password'; btn.disabled = false

    if (error) { showError(error.message); return }

    document.getElementById('screen-form').classList.add('hidden')
    document.getElementById('screen-success').classList.remove('hidden')
  }
</script>
</body>
</html>
