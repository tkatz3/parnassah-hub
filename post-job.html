<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Post a Job — ParnassaHub</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: { 50:'#ebf3ff',100:'#d6e8ff',200:'#add0ff',300:'#85b8ff',400:'#5c9ef5',500:'#2877C9',600:'#1d62aa',700:'#154d8b' }
          },
          fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] }
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Inter', system-ui, sans-serif; }
    input:focus, textarea:focus, select:focus { outline:none; }
    .step-item { position:relative; }
    .step-item:not(:last-child)::after { content:''; position:absolute; top:14px; left:calc(50% + 20px); width:calc(100% - 28px); height:2px; background:#e5e7eb; }
    .step-item.done::after { background:#2877C9; }
    .step-item.active::after { background: linear-gradient(to right,#2877C9,#e5e7eb); }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 antialiased min-h-screen flex flex-col">

<!-- TOP BAR -->
<header class="bg-white border-b border-gray-100 py-4 px-6 flex items-center justify-between">
  <a href="employer-dashboard.html"><img src="parnassah hub.png" alt="ParnassaHub" class="h-14 w-auto" /></a>
  <a href="employer-dashboard.html" class="inline-flex items-center gap-1 text-sm text-gray-500 hover:text-gray-700">
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
    Back to Dashboard
  </a>
</header>

<!-- MAIN -->
<main class="flex-1 py-10 px-4">
  <div class="max-w-2xl mx-auto">

    <div class="text-center mb-8">
      <h1 class="text-2xl sm:text-3xl font-extrabold text-gray-900 mb-2">Post a New Job</h1>
      <p class="text-gray-500 text-sm">Fill in the details to publish your listing on ParnassaHub</p>
    </div>

    <!-- ERROR BANNER -->
    <div id="error-banner" class="hidden mb-5 p-3 bg-red-50 border border-red-200 rounded-xl text-sm text-red-700"></div>

    <!-- STEP INDICATOR -->
    <div id="step-indicator" class="flex justify-center gap-0 mb-10">
      <div id="si1" class="step-item done flex flex-col items-center gap-1 w-28 text-center">
        <div class="w-7 h-7 rounded-full bg-brand-500 text-white text-xs font-bold flex items-center justify-center z-10">1</div>
        <span class="text-xs font-medium text-brand-500">Job Details</span>
      </div>
      <div id="si2" class="step-item flex flex-col items-center gap-1 w-28 text-center">
        <div id="dot2" class="w-7 h-7 rounded-full bg-gray-200 text-gray-400 text-xs font-bold flex items-center justify-center z-10">2</div>
        <span id="sl2" class="text-xs font-medium text-gray-400">Description</span>
      </div>
      <div id="si3" class="step-item flex flex-col items-center gap-1 w-28 text-center">
        <div id="dot3" class="w-7 h-7 rounded-full bg-gray-200 text-gray-400 text-xs font-bold flex items-center justify-center z-10">3</div>
        <span id="sl3" class="text-xs font-medium text-gray-400">Review &amp; Publish</span>
      </div>
    </div>

    <!-- STEP 1: Job Details -->
    <div id="step-1" class="space-y-5">
      <div class="bg-white rounded-2xl border border-gray-200 p-6 space-y-5">
        <h3 class="text-sm font-bold text-gray-700">Basic Information</h3>
        <div>
          <label class="block text-xs font-medium text-gray-600 mb-1.5">Job Title *</label>
          <input id="f-title" type="text" placeholder="e.g. Senior Accountant, Office Manager…" class="w-full px-3.5 py-2.5 border border-gray-200 rounded-xl text-sm focus:border-brand-400 transition" />
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1.5">Category *</label>
            <select id="f-category" class="w-full px-3.5 py-2.5 border border-gray-200 rounded-xl text-sm focus:border-brand-400 focus:outline-none transition appearance-none">
              <option value="" disabled selected>Select category…</option>
              <option>Accounting &amp; Auditing</option><option>Admin Support</option>
              <option>Administration &amp; Middle Management</option><option>Education</option>
              <option>Finance &amp; Banking</option><option>Human Resources</option>
              <option>Marketing / Advertising / PR</option><option>Office Manager &amp; Secretary</option>
              <option>Operations</option><option>Real Estate</option><option>Religious</option>
              <option>Sales &amp; Marketing</option><option>Secretarial / Clerical / Administrative</option>
              <option>Transportation &amp; Auto Industry</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1.5">Vacancy Type *</label>
            <select id="f-type" class="w-full px-3.5 py-2.5 border border-gray-200 rounded-xl text-sm focus:border-brand-400 focus:outline-none transition appearance-none">
              <option value="" disabled selected>Select type…</option>
              <option>Full Time</option><option>Part-Time</option><option>Commission</option><option>Volunteer</option>
            </select>
          </div>
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-600 mb-1.5">Location *</label>
          <select id="f-location" class="w-full px-3.5 py-2.5 border border-gray-200 rounded-xl text-sm focus:border-brand-400 focus:outline-none transition appearance-none">
            <option value="" disabled selected>Select location…</option>
            <option>Greater Lakewood Area</option><option>Linden NJ</option><option>Monsey</option>
            <option>New Jersey</option><option>New York City</option><option>Newark</option>
            <option>Northern New Jersey</option><option>Remote</option><option>Union County</option><option>Worldwide</option>
          </select>
        </div>
      </div>

      <div class="bg-white rounded-2xl border border-gray-200 p-6 space-y-5">
        <h3 class="text-sm font-bold text-gray-700">Compensation</h3>
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1.5">Salary / Rate From</label>
            <div class="flex items-center border border-gray-200 rounded-xl overflow-hidden focus-within:border-brand-400 transition">
              <span class="px-3 text-gray-400 text-sm bg-gray-50 border-r border-gray-200 py-2.5 shrink-0">$</span>
              <input id="f-sal-min" type="number" placeholder="50,000" class="flex-1 px-3 py-2.5 text-sm focus:outline-none" />
            </div>
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-600 mb-1.5">Salary / Rate To</label>
            <div class="flex items-center border border-gray-200 rounded-xl overflow-hidden focus-within:border-brand-400 transition">
              <span class="px-3 text-gray-400 text-sm bg-gray-50 border-r border-gray-200 py-2.5 shrink-0">$</span>
              <input id="f-sal-max" type="number" placeholder="70,000" class="flex-1 px-3 py-2.5 text-sm focus:outline-none" />
            </div>
          </div>
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-600 mb-1.5">Pay Period</label>
          <div class="flex flex-wrap gap-2">
            <label class="flex items-center gap-1.5 cursor-pointer text-xs border border-gray-200 rounded-full px-3 py-1.5 hover:border-brand-300 hover:bg-brand-50 transition"><input type="radio" name="payperiod" value="Annual" style="accent-color:#2877C9" /> Annual</label>
            <label class="flex items-center gap-1.5 cursor-pointer text-xs border border-gray-200 rounded-full px-3 py-1.5 hover:border-brand-300 hover:bg-brand-50 transition"><input type="radio" name="payperiod" value="Hourly" style="accent-color:#2877C9" /> Hourly</label>
            <label class="flex items-center gap-1.5 cursor-pointer text-xs border border-gray-200 rounded-full px-3 py-1.5 hover:border-brand-300 hover:bg-brand-50 transition"><input type="radio" name="payperiod" value="Daily" style="accent-color:#2877C9" /> Daily</label>
            <label class="flex items-center gap-1.5 cursor-pointer text-xs border border-gray-200 rounded-full px-3 py-1.5 hover:border-brand-300 hover:bg-brand-50 transition"><input type="radio" name="payperiod" value="Commission Only" style="accent-color:#2877C9" /> Commission Only</label>
            <label class="flex items-center gap-1.5 cursor-pointer text-xs border border-gray-200 rounded-full px-3 py-1.5 hover:border-brand-300 hover:bg-brand-50 transition"><input type="radio" name="payperiod" value="Unpaid / Volunteer" style="accent-color:#2877C9" /> Unpaid / Volunteer</label>
          </div>
        </div>
      </div>

      <button onclick="goStep(2)" class="w-full py-3.5 bg-brand-500 hover:bg-brand-600 text-white font-semibold text-sm rounded-xl transition">Continue to Description →</button>
    </div>

    <!-- STEP 2: Description -->
    <div id="step-2" class="space-y-5 hidden">
      <div class="bg-white rounded-2xl border border-gray-200 p-6 space-y-5">
        <h3 class="text-sm font-bold text-gray-700">Job Description</h3>
        <div>
          <label class="block text-xs font-medium text-gray-600 mb-1.5">Full Job Description *</label>
          <textarea id="f-desc" rows="8" placeholder="Describe the role, responsibilities, requirements, and any other relevant details. Be clear and honest — quality candidates will appreciate the transparency." class="w-full px-3.5 py-2.5 border border-gray-200 rounded-xl text-sm focus:border-brand-400 transition resize-none leading-relaxed"></textarea>
          <p class="text-xs text-gray-400 mt-1.5">Minimum 100 characters. Good descriptions attract better candidates.</p>
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-600 mb-1.5">Key Requirements</label>
          <textarea id="f-req" rows="4" placeholder="• 3+ years experience in accounting&#10;• Proficiency in QuickBooks&#10;• Strong attention to detail" class="w-full px-3.5 py-2.5 border border-gray-200 rounded-xl text-sm focus:border-brand-400 transition resize-none leading-relaxed"></textarea>
        </div>
        <div>
          <label class="block text-xs font-medium text-gray-600 mb-1.5">How to Apply</label>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="text-xs text-gray-500 mb-1 block">Contact Email</label>
              <input id="f-contact-email" type="email" placeholder="hr@yourcompany.com" class="w-full px-3.5 py-2.5 border border-gray-200 rounded-xl text-sm focus:border-brand-400 transition" />
            </div>
            <div>
              <label class="text-xs text-gray-500 mb-1 block">Contact Phone (optional)</label>
              <input id="f-contact-phone" type="tel" placeholder="(908) 555-0100" class="w-full px-3.5 py-2.5 border border-gray-200 rounded-xl text-sm focus:border-brand-400 transition" />
            </div>
          </div>
        </div>
        <div class="bg-amber-50 border border-amber-100 rounded-xl p-4 text-xs text-amber-800 leading-relaxed">
          <strong>Community Pledge:</strong> By posting on ParnassaHub, you confirm this is an authentic, active opportunity.
        </div>
      </div>
      <div class="flex gap-3">
        <button onclick="goStep(1)" class="flex-1 py-3.5 border border-gray-200 text-gray-600 font-semibold text-sm rounded-xl hover:bg-gray-50 transition">← Back</button>
        <button onclick="goStep(3)" class="flex-1 py-3.5 bg-brand-500 hover:bg-brand-600 text-white font-semibold text-sm rounded-xl transition">Review Listing →</button>
      </div>
    </div>

    <!-- STEP 3: Review & Publish -->
    <div id="step-3" class="space-y-5 hidden">
      <div class="bg-white rounded-2xl border border-gray-200 p-6">
        <h3 class="text-sm font-bold text-gray-700 mb-4">Listing Preview</h3>
        <div class="border border-gray-200 rounded-xl p-5 space-y-3">
          <div class="flex items-start justify-between gap-3">
            <div id="prev-abbr" class="w-10 h-10 rounded-xl bg-brand-50 flex items-center justify-center text-sm font-bold text-brand-600">—</div>
            <span id="prev-type-badge" class="text-xs font-semibold px-2.5 py-1 bg-green-50 text-green-700 rounded-full">—</span>
          </div>
          <div>
            <h4 id="prev-title" class="font-bold text-gray-900">—</h4>
            <p id="prev-company" class="text-sm text-gray-500">—</p>
          </div>
          <div class="flex flex-wrap gap-3 text-xs text-gray-500">
            <span class="flex items-center gap-1"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a2 2 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/></svg><span id="prev-loc">—</span></span>
            <span class="flex items-center gap-1"><svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A2 2 0 013 12V7a2 2 0 012-2h2z"/></svg><span id="prev-cat">—</span></span>
          </div>
          <p id="prev-desc" class="text-sm text-gray-500 leading-relaxed pt-1 border-t border-gray-100 mt-2 line-clamp-3">—</p>
        </div>
      </div>

      <div class="bg-white rounded-2xl border border-gray-200 p-6 space-y-4">
        <h3 class="text-sm font-bold text-gray-700">Confirm &amp; Publish</h3>
        <div class="flex items-start gap-3">
          <input type="checkbox" id="pledgeCheck" class="w-4 h-4 mt-0.5 shrink-0" style="accent-color:#2877C9" />
          <label for="pledgeCheck" class="text-sm text-gray-600 cursor-pointer leading-relaxed">
            I confirm this is a real, active job opportunity. I agree to ParnassaHub's community standards and will respond to qualified applicants in good faith.
          </label>
        </div>
        <div class="bg-brand-50 border border-brand-100 rounded-xl p-3 text-xs text-brand-700 leading-relaxed">
          <strong>Free to post!</strong> ParnassaHub is volunteer-run. Posting a job is completely free.
        </div>
      </div>

      <div class="flex gap-3">
        <button onclick="goStep(2)" class="flex-1 py-3.5 border border-gray-200 text-gray-600 font-semibold text-sm rounded-xl hover:bg-gray-50 transition">← Back</button>
        <button id="publish-btn" onclick="publishJob()" class="flex-1 py-3.5 bg-brand-500 hover:bg-brand-600 text-white font-semibold text-sm rounded-xl transition">Publish Job Listing</button>
      </div>
    </div>

    <!-- SUCCESS -->
    <div id="step-success" class="hidden">
      <div class="bg-white rounded-2xl border border-gray-200 p-10 text-center">
        <div class="w-16 h-16 rounded-full bg-green-50 flex items-center justify-center mx-auto mb-4">
          <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg>
        </div>
        <h2 class="text-xl font-bold text-gray-900 mb-2">Your job is live!</h2>
        <p class="text-sm text-gray-500 mb-7 max-w-sm mx-auto">Your listing has been published. Qualified candidates in the community can now apply.</p>
        <div class="flex flex-col sm:flex-row gap-3 justify-center">
          <a href="employer-dashboard.html" class="inline-flex items-center justify-center py-3 px-6 bg-brand-500 hover:bg-brand-600 text-white font-semibold text-sm rounded-xl transition">Go to Dashboard</a>
          <button onclick="resetForm()" class="inline-flex items-center justify-center py-3 px-6 border border-gray-200 text-gray-600 font-medium text-sm rounded-xl hover:bg-gray-50 transition">Post Another Job</button>
        </div>
      </div>
    </div>

  </div>
</main>

<footer class="text-center py-5 text-xs text-gray-400 border-t border-gray-100">
  &copy; 2025 ParnassaHub &middot; Volunteer-run &middot; Sponsored by <a href="https://omrgroup.net" class="hover:text-gray-600">ORTEK Group</a>
</footer>

<script src="js/supabase-client.js"></script>
<script>
  let currentStep = 1
  let companyId = null
  let companyName = ''

  // Guard: employer only
  ;(async () => {
    const profile = await requireRole('employer', 'signup.html')
    if (!profile) return
    // Load company
    const { data: co } = await sb.from('companies').select('id,name').eq('user_id', profile.id).single()
    if (co) { companyId = co.id; companyName = co.name }
  })()

  function showError(msg) { const el = document.getElementById('error-banner'); el.textContent = msg; el.classList.remove('hidden'); window.scrollTo(0,0) }
  function clearError() { document.getElementById('error-banner').classList.add('hidden') }

  const totalSteps = 3
  function goStep(n) {
    clearError()
    document.getElementById('step-' + currentStep).classList.add('hidden')
    document.getElementById('step-' + n).classList.remove('hidden')
    for (let i = 1; i <= totalSteps; i++) {
      const dot = document.getElementById('dot' + i)
      const label = document.getElementById('sl' + i)
      const si = document.getElementById('si' + i)
      if (!dot) continue
      if (i < n) {
        dot.className = 'w-7 h-7 rounded-full bg-brand-500 text-white text-xs font-bold flex items-center justify-center z-10'
        dot.innerHTML = '✓'
        if (label) label.className = 'text-xs font-medium text-brand-500'
        si.className = 'step-item done flex flex-col items-center gap-1 w-28 text-center'
      } else if (i === n) {
        dot.className = 'w-7 h-7 rounded-full bg-brand-500 text-white text-xs font-bold flex items-center justify-center z-10'
        dot.innerHTML = i
        if (label) label.className = 'text-xs font-medium text-brand-500'
        si.className = 'step-item active flex flex-col items-center gap-1 w-28 text-center'
      } else {
        dot.className = 'w-7 h-7 rounded-full bg-gray-200 text-gray-400 text-xs font-bold flex items-center justify-center z-10'
        dot.innerHTML = i
        if (label) label.className = 'text-xs font-medium text-gray-400'
        si.className = 'step-item flex flex-col items-center gap-1 w-28 text-center'
      }
    }
    if (n === 3) populatePreview()
    currentStep = n
    window.scrollTo(0, 0)
  }

  function populatePreview() {
    const title = document.getElementById('f-title').value || '—'
    const cat   = document.getElementById('f-category').value || '—'
    const type  = document.getElementById('f-type').value || '—'
    const loc   = document.getElementById('f-location').value || '—'
    const desc  = document.getElementById('f-desc').value || '—'
    const abbr  = initials(companyName || title)
    document.getElementById('prev-title').textContent = title
    document.getElementById('prev-company').textContent = companyName || '—'
    document.getElementById('prev-cat').textContent = cat
    document.getElementById('prev-loc').textContent = loc
    document.getElementById('prev-desc').textContent = desc
    document.getElementById('prev-abbr').textContent = abbr
    document.getElementById('prev-type-badge').textContent = type
  }

  async function publishJob() {
    clearError()
    if (!document.getElementById('pledgeCheck').checked) { showError('Please confirm the community pledge to publish.'); return }
    if (!companyId) { showError('Could not find your company. Please contact support.'); return }

    const title   = document.getElementById('f-title').value.trim()
    const cat     = document.getElementById('f-category').value
    const type    = document.getElementById('f-type').value
    const loc     = document.getElementById('f-location').value
    const desc    = document.getElementById('f-desc').value.trim()
    const req     = document.getElementById('f-req').value.trim()
    const email   = document.getElementById('f-contact-email').value.trim()
    const phone   = document.getElementById('f-contact-phone').value.trim()
    const salMin  = parseInt(document.getElementById('f-sal-min').value) || null
    const salMax  = parseInt(document.getElementById('f-sal-max').value) || null
    const period  = document.querySelector('input[name="payperiod"]:checked')?.value || null

    if (!title || !cat || !type || !loc) { showError('Please fill in all required fields (title, category, type, location).'); return }
    if (desc.length < 50) { showError('Please write a more detailed job description (at least 50 characters).'); return }

    const btn = document.getElementById('publish-btn')
    btn.textContent = 'Publishing…'; btn.disabled = true

    const { error } = await sb.from('jobs').insert({
      company_id: companyId,
      title, category: cat, vacancy_type: type, location: loc,
      description: desc || null,
      requirements: req || null,
      contact_email: email || null,
      contact_phone: phone || null,
      salary_min: salMin, salary_max: salMax,
      pay_period: period,
      active: true,
    })

    if (error) { showError('Error publishing job: ' + error.message); btn.textContent = 'Publish Job Listing'; btn.disabled = false; return }

    document.getElementById('step-3').classList.add('hidden')
    document.getElementById('step-success').classList.remove('hidden')
    document.getElementById('step-indicator').classList.add('invisible')
    window.scrollTo(0, 0)
  }

  function resetForm() {
    document.getElementById('step-success').classList.add('hidden')
    document.getElementById('step-indicator').classList.remove('invisible')
    // Clear fields
    ;['f-title','f-desc','f-req','f-contact-email','f-contact-phone','f-sal-min','f-sal-max'].forEach(id => {
      const el = document.getElementById(id); if (el) el.value = ''
    })
    ;['f-category','f-type','f-location'].forEach(id => {
      const el = document.getElementById(id); if (el) el.selectedIndex = 0
    })
    document.querySelectorAll('input[name="payperiod"]').forEach(r => r.checked = false)
    document.getElementById('pledgeCheck').checked = false
    goStep(1)
  }

  // Init step indicator
  document.getElementById('si1').className = 'step-item done flex flex-col items-center gap-1 w-28 text-center'
</script>
</body>
</html>
